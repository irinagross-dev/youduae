# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –õ–∏—Å—Ç–∏–Ω–≥–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`transition/complete`) –∏ –æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞, –ª–∏—Å—Ç–∏–Ω–≥ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `published` –≤–º–µ—Å—Ç–æ `closed`.

**–ò–∑ –ª–æ–≥–æ–≤:**
```javascript
processState: "reviewed-by-provider"  // ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
allStates: ['published', 'published']  // ‚ùå –õ–∏—Å—Ç–∏–Ω–≥–∏ –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã!
closedListings: 0  // ‚ùå –°—á—ë—Ç—á–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

## –ü—Ä–∏—á–∏–Ω–∞

–í —Ñ–∞–π–ª–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ `assignment-flow-v3/process.edn` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ `action/close-listing` –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ `transition/complete`.

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –®–ê–ì 1: –§–∞–π–ª —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ `:action/close-listing` –≤ `transition/complete`:

```clojure
{:name :transition/complete,
 :actor :actor.role/provider,
 :actions [{:name :action/close-listing}],  ;; ‚Üê –î–û–ë–ê–í–õ–ï–ù–û!
 :from :state/accepted,
 :to :state/completed,
 :privileged? true}
```

**–§–∞–π–ª:** `ext/transaction-processes/assignment-flow-v3/process.edn` (—Å—Ç—Ä–æ–∫–∞ 21)

### üöÄ –®–ê–ì 2: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –≤ Sharetribe

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤ Sharetribe Console —á–µ—Ä–µ–∑ Flex CLI.

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ Flex CLI (—Ç–µ—Ä–º–∏–Ω–∞–ª)

```bash
cd /Users/admin/web-template/ext/transaction-processes/assignment-flow-v3

flex-cli process push \\
  --path . \\
  --process assignment-flow-v3 \\
  --marketplace YOUR_MARKETPLACE_ID
```

**–ì–¥–µ –Ω–∞–π—Ç–∏ `YOUR_MARKETPLACE_ID`:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [Sharetribe Console](https://console.sharetribe.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Build ‚Üí Transaction processes**
3. –í–∞—à Marketplace ID –æ–±—ã—á–Ω–æ —É–∫–∞–∑–∞–Ω –≤ URL –∏–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

–ü—Ä–∏–º–µ—Ä—ã Marketplace ID:
- `youdu`
- `youdu-production`
- `prod-boyan-1`

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ Sharetribe Console (UI)

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: `ext/transaction-processes/assignment-flow-v3/process.edn`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
3. –û—Ç–∫—Ä–æ–π—Ç–µ [Sharetribe Console](https://console.sharetribe.com/)
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Build ‚Üí Transaction processes**
5. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å `assignment-flow-v3`
6. –ù–∞–∂–º–∏—Ç–µ **"Edit process"** –∏–ª–∏ **"Create new version"**
7. –í—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
8. –ù–∞–∂–º–∏—Ç–µ **"Save"** –∏ **"Publish"**

### üìã –®–ê–ì 3: –û–±–Ω–æ–≤–∏—Ç–µ –∞–ª–∏–∞—Å –ø—Ä–æ—Ü–µ—Å—Å–∞

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `release-2`):

```bash
flex-cli process update-alias \\
  --process assignment-flow-v3 \\
  --alias release-1 \\
  --version 2 \\
  --marketplace YOUR_MARKETPLACE_ID
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Console:
1. **Build ‚Üí Transaction processes**
2. –ù–∞–π–¥–∏—Ç–µ `assignment-flow-v3`
3. **Aliases ‚Üí release-1**
4. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ **version 2**
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### üß™ –®–ê–ì 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–∫–∞–∫ Provider)
```
http://localhost:3000/l/new
```

#### 2. –ù–∞–π–¥–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Customer –æ—Ç–∫–ª–∏–∫–∞–µ—Ç—Å—è)

#### 3. Provider –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞–Ω–∏–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–∫—Ä—ã—Ç—å –∑–∞–¥–∞–Ω–∏–µ"** (–≤—ã–∑–æ–≤–µ—Ç `transition/complete`)
- **–¢–µ–ø–µ—Ä—å –ª–∏—Å—Ç–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

#### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å Provider
```
http://localhost:3000/u/{providerId}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```javascript
üìä Profile listings: {
  closedListings: 1,  // ‚úÖ –¢–µ–ø–µ—Ä—å 1!
  allStates: ['closed']  // ‚úÖ –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è!
}

‚úÖ Final value showing in UI: 1  // ‚úÖ –°—á—ë—Ç—á–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

### ‚ö†Ô∏è –í–∞–∂–Ω–æ!

#### –°—Ç–∞—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ù–ï –æ–±–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ **–Ω–æ–≤—ã–µ** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –°—Ç–∞—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `reviewed-by-provider`) –æ—Å—Ç–∞–Ω—É—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –∏ –∏—Ö –ª–∏—Å—Ç–∏–Ω–≥–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è `published`.

**–ß—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–∏—Å—Ç–∏–Ω–≥–∏**, –Ω—É–∂–Ω–æ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Sharetribe Console**
1. –û—Ç–∫—Ä–æ–π—Ç–µ **Manage ‚Üí Listings**
2. –ù–∞–π–¥–∏—Ç–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ª–∏—Å—Ç–∏–Ω–≥–∏ (–≥–¥–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
3. –í—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∞ `closed`

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Integration API**
–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ª–∏—Å—Ç–∏–Ω–≥–æ–≤:

```javascript
// –ü—Å–µ–≤–¥–æ–∫–æ–¥
const completedTransactions = await sdk.transactions.query({
  lastTransition: ['transition/review-1-by-provider', 'transition/reviewed']
});

for (const tx of completedTransactions) {
  const listingId = tx.listing.id;
  await sdk.listings.close({ id: listingId });
}
```

## üìä –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
Provider –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞–Ω–∏–µ ‚Üí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: completed
‚Üí –õ–∏—Å—Ç–∏–Ω–≥: published (‚ùå –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
‚Üí –°—á—ë—Ç—á–∏–∫: 0
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
Provider –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞–Ω–∏–µ ‚Üí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: completed
‚Üí action/close-listing –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
‚Üí –õ–∏—Å—Ç–∏–Ω–≥: closed (‚úÖ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
‚Üí –°—á—ë—Ç—á–∏–∫: 1 (‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç!)
```

## üéØ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –ª–∏—Å—Ç–∏–Ω–≥ –∑–∞–∫—Ä—ã–≤–∞–ª—Å—è **–ø–æ—Å–ª–µ –æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞**, –∞ –Ω–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, –¥–æ–±–∞–≤—å—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –¥—Ä—É–≥–æ–π transition:

```clojure
{:name :transition/review-1-by-provider,
 :actor :actor.role/provider,
 :actions [{:name :action/post-review-by-provider}
           {:name :action/close-listing}],  ;; ‚Üê –î–æ–±–∞–≤–∏—Ç—å —Å—é–¥–∞
 :from :state/completed,
 :to :state/reviewed-by-provider}
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [x] –§–∞–π–ª `process.edn` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (–¥–æ–±–∞–≤–ª–µ–Ω–æ `:action/close-listing`)
- [ ] –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Sharetribe (—á–µ—Ä–µ–∑ CLI –∏–ª–∏ Console)
- [ ] –ê–ª–∏–∞—Å –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
- [ ] –°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- [ ] –ó–∞–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ‚Üí –ª–∏—Å—Ç–∏–Ω–≥ –∑–∞–∫—Ä—ã—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –°—á—ë—Ç—á–∏–∫ –≤ –ø—Ä–æ—Ñ–∏–ª–µ Provider –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°—Ç–∞—Ä—ã–µ –ª–∏—Å—Ç–∏–Ω–≥–∏ –∑–∞–∫—Ä—ã—Ç—ã –≤—Ä—É—á–Ω—É—é

## üìû –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å

–°–æ–æ–±—â–∏—Ç–µ –º–Ω–µ:
1. –í–∞—à Marketplace ID
2. –°–∫—Ä–∏–Ω—à–æ—Ç –∏–∑ Sharetribe Console ‚Üí Transaction processes
3. –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–∞–Ω–¥—ã: `flex-cli process list --marketplace YOUR_ID`

–ò —è –ø–æ–º–æ–≥—É —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å–∞! üöÄ

